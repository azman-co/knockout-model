function fnCompare(t,e){return t?("object"==typeof t&&t.constructor&&(t=t.constructor),"function"==typeof t&&(t=""+t),t===e):!1}function each(t,e){if(t=t||[],"string"==typeof t&&(t=[t]),"number"==typeof t.length){for(var n=0;t.length>n;n++)if(e(n,t[n])===!1)return}else for(var i in t)if(e(i,t[i])===!1)return}function generateObserver(t){return ko.computed({read:function(){return t},write:function(e){t.from(e)},owner:t})}function interpretDefinition(t,e){each(e,function(e,n){if(ku.isModel(n)||ku.isCollection(n))return t.relations[e]=n,void 0;if("function"==typeof n){var i,r;return ku.isReader(e)?(i=ku.fromReader(e),r="read"):ku.isWriter(e)&&(i=ku.fromWriter(e),r="write"),r?(t.computed[i]===void 0&&(t.computed[i]={}),t.computed[i][r]=n,void 0):(t.methods[e]=n,void 0)}t.properties[e]=n})}function define(t){t.observer=generateObserver(t),defineComputed(t),defineMethods(t),defineProperties(t),defineRelations(t)}function defineComputed(t){each(t.$self.computed,function(e,n){t[e]=ko.computed({owner:t,deferEvaluation:!0,read:n.read||function(){},write:n.write||function(){}})})}function defineMethods(t){each(t.$self.methods,function(e,n){t[e]=function(){return n.apply(t,arguments)}})}function defineProperties(t){each(t.$self.properties,function(e,n){t[e]="[object Array]"===Object.prototype.toString.call(n)?ko.observableArray(n):ko.observable(n)})}function defineRelations(t){each(t.$self.relations,function(e,n){var i=new n;t[e]=i.observer,i.$parent=t})}function removeHostPart(t){return t.replace(/http(s)?\:\/\/[^\/]+/,"")}function bind(t){window.addEventListener?window.addEventListener(t,dispatch,!1):window["on"+t]=dispatch}function trigger(t){document.createEvent?(event=document.createEvent("HTMLEvents"),event.initEvent(t,!0,!0),window.dispatchEvent(event)):window["on"+t](document.createEventObject())}function updateHash(t,e){if(!e){var n=t.replace(/^#/,""),i=document.getElementById(n),r=window.pageXOffset?window.pageXOffset:document.body.scrollLeft,o=window.pageYOffset?window.pageYOffset:document.body.scrollTop,s=document.createElement("div");i&&(i.id=""),s.id=n||"_",s.style.position="absolute",s.style.width=0,s.style.height=0,s.style.left=r+"px",s.style.top=o+"px",s.style.padding=0,s.style.margin=0,document.body.appendChild(s),window.location.hash="#"+s.id,document.body.removeChild(s),i&&(i.id=n)}}function dispatch(){for(var t=0;bound.length>t;t++)bound[t].dispatch()}ku.bindings={model:function(t,e){this.attr(t,"view")||ko.applyBindings(this.get(e),t)},router:function(t,e){var n=this.get(e);n||ku.throwForElement(t,'Cannot bind router "'+e+'" to the main view because it does not exist.'),!n instanceof this.Router&&ku.throwForElement(t,'Cannot bind router "'+e+'" to the main view because it is not an instanceof "ku.Router".'),n.view.target=t,n.bind()},view:function(t,e){var n,i=this.attr(t,"path"),r=this.get(this.attr(t,"model"));if(i)n=this.get(e);else{var o=this.attr(t,"prefix"),s=this.attr(t,"suffix");n=new ku.View,o&&(n.http.prefix=o),s&&(n.http.suffix=s)}n.target=t,n.render(i,r)}},ku.collection=function(t){var e=function(e){Array.prototype.push.apply(this,[]),this.observer=generateObserver(this),this.aggregate=function(t,e){var n=[];return e||(e=[t],t=""),this.each(function(i,r){var o=[];each(e,function(t,e){"function"==typeof r[e]&&o.push(r[e]())}),n.push(o.join(t))}),n},this.at=function(t){return this[t]===void 0?!1:this[t]},this.first=function(){return this.at(0)},this.last=function(){return this.at(this.length-1)},this.has=function(t){return this[t]!==void 0},this.remove=function(t){return t="number"==typeof t?t:this.index(t),this.has(t)&&(Array.prototype.splice.call(this,t,1),this.observer.notifySubscribers(this)),this},this.empty=function(){return Array.prototype.splice.call(this,0,this.length),this.observer.notifySubscribers(this),this},this.prepend=function(t){return this.insert(0,t)},this.append=function(t){return this.insert(this.length,t)},this.insert=function(e,n){return n=ku.isModel(n)?n:new t(n),n.$parent=this.$parent,Array.prototype.splice.call(this,e,0,n),this.observer.notifySubscribers(this),this},this.replace=function(e,n){return n=ku.isModel(n)?n:new t(n),n.$parent=this.$parent,Array.prototype.splice.call(this,e,1,n),this.observer.notifySubscribers(this),this},this.index=function(t){var e=-1;return this.each(function(n,i){return i===t?(e=n,void 0):void 0}),e},this.from=function(t){var e=this;return ku.isCollection(t)&&(t=t.raw()),each(t,function(t,n){e.has(t)?e.replace(t,n):e.replace(t,n)}),this},this.raw=function(){var t=[];return this.each(function(e,n){t.push(n.raw())}),t},this.each=function(t){for(var e=0;this.length>e;e++)t.call(this,e,this[e]);return this},this.find=function(t,e,n){var i=new this.$self.Model.Collection;return i.$parent=this.$parent,ku.isModel(t)&&(t=t.raw()),"object"==typeof t&&(t=function(t){return function(){var e=this,n=!0;return each(t,function(t,i){return e[t]===void 0||e[t]()!==i?(n=!1,!1):void 0}),n}}(t)),this.each(function(r,o){if(e&&n){var s=e*n-e;if(r>s)return}return t.call(o,r)&&i.append(o),e&&i.length===e?!1:void 0}),i},this.findOne=function(t){return this.find(t,1).first()},this["export"]=this.raw,this["import"]=this.from,this.from(e)};return e.Model=t,e.prototype={$self:e},e};var globals={};ku.set=function(t,e){return globals[t]=e,this},ku.get=function(t){return this.has(t)?globals[t]:null},ku.has=function(t){return globals[t]!==void 0},ku.remove=function(t){return this.has(t)&&delete globals[t],this},ku.reset=function(){return globals={},this},ku.Event=function(){return this.stack=[],this},ku.Event.prototype={bind:function(t){return this.stack.push(t),this},unbind:function(t){if(t){var e=[];for(var n in this.stack)this.stack[n]!==t&&e.push(this.stack[n]);this.stack=e}else this.stack=[];return this},trigger:function(t){for(var e in this.stack)if(this.stack[e].apply(this,t)===!1)return!1}},ku.Events=function(){return this.events={},this},ku.Events.prototype={on:function(t,e){return this.events[t]===void 0&&(this.events[t]=new ku.Event),this.events[t].bind(e),this},off:function(t,e){return t?(this.events[t]!==void 0&&this.events[t].unbind(e),this):(this.events={},this)},trigger:function(t,e){return this.events[t]!==void 0&&this.events[t].trigger(e)===!1?!1:void 0}},ku.Http=function(){return this.events=new ku.Events,this},ku.Http.prototype={prefix:"",suffix:"",headers:{},parsers:{"application/json":function(t){try{return JSON.parse(t)}catch(e){throw'Error parsing response "'+t+'" with message "'+e+'".'}}},"delete":function(t,e,n){return this.request(t,e||{},"delete",n||e)},get:function(t,e,n){return this.request(t,e||{},"get",n||e)},head:function(t,e,n){return this.request(t,e||{},"head",n||e)},options:function(t,e,n){return this.request(t,e||{},"options",n||e)},patch:function(t,e,n){return this.request(t,e,"patch",n)},post:function(t,e,n){return this.request(t,e,"post",n)},put:function(t,e,n){return this.request(t,e,"put",n)},request:function(t,e,n,i){var r=this,o=this.createRequestObject(),s="";"function"==typeof e&&(e=void 0),ku.isModel(e)&&(e=e.raw()),"object"==typeof e&&(e=this.serialize(e)),e&&"get"===n.toLowerCase()&&(s="?"+e,e=void 0),o.open(n.toUpperCase(),this.prefix+t+this.suffix+s,!0);for(var u in this.headers)o.setRequestHeader(u,this.headers[u]);return o.onreadystatechange=function(){if(4===o.readyState){var t=o.responseText,e=o.getAllResponseHeaders();if("string"==typeof e["Content-Type"]&&"function"==typeof r.parsers[e["Content-Type"]]?t=r.parsers[e["Content-Type"]](t):"string"==typeof r.headers.Accept&&"function"==typeof r.parsers[r.headers.Accept]&&500!==o.status&&(t=r.parsers[r.headers.Accept](t)),200!==o.status&&304!==o.status)return r.events.trigger("error",[t,o]),r.events.trigger("stop",[t,o]),void 0;"function"==typeof i&&i(t,o),r.events.trigger("success",[t,o]),r.events.trigger("stop",[o])}},4!==o.readyState?(e&&o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),this.events.trigger("start",[o]),o.send(e),this):void 0},serialize:function(t,e){var n=[];for(var i in t){var r=e?e+"["+i+"]":i,o=t[i];n.push("object"==typeof o?this.serialize(o,r):encodeURIComponent(r)+"="+encodeURIComponent(o))}return n.join("&")},createRequestObject:function(){var t=!1;factories=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];for(var e=0;factories.length>e;e++)try{t=factories[e]()}catch(n){continue}if(!t)throw"An XMLHttpRequest could not be generated.";return t}},ku.prefix="data-ku-",ku.element=document,ku.run=function(t){t=t||this.element,"function"==typeof t&&(t=t()),"string"==typeof t&&(t=document.getElementById(t)),t!==document&&ku.bindOne(t),ku.bindDescendants(t)},ku.bindOne=function(t){var e=this;each(t.attributes,function(n,i){if(0===i.name.indexOf(e.prefix)){var r=i.name.substring(e.prefix.length);"function"==typeof e.bindings[r]&&e.bindings[r].call(e,t,i.value)}})},ku.bindDescendants=function(t){each(t.childNodes,function(t,e){ku.run(e)})},ku.attr=function(t,e,n){return e=ku.prefix+e,n===void 0?t.getAttribute?t.getAttribute(e):t[e]===void 0?null:t[e]:n?(t.setAttribute?t.setAttribute(e,n):t[e]=n,this):(t.removeAttribute?t.removeAttribute(e):t[e]!==void 0&&delete t[e],this)},ku.outerHtml=function(t){var e=document.createElement("div");return e.appendChild(t),e.innerHTML},ku.throwForElement=function(t,e){throw e+"\n"+ku.outerHtml(t)},ku.isReader=function(t){return 0===t.indexOf("read")},ku.isWriter=function(t){return 0===t.indexOf("write")},ku.toReader=function(t){return"read"+t.substring(0,1).toUpperCase()+t.substring(1)},ku.toWriter=function(t){return"write"+t.substring(0,1).toUpperCase()+t.substring(1)},ku.fromReader=function(t){return t.substring(4,5).toLowerCase()+t.substring(5)},ku.fromWriter=function(t){return t.substring(5,6).toLowerCase()+t.substring(6)},ku.isModel=function(t){return fnCompare(t,""+ku.model())},ku.isCollection=function(t){return fnCompare(t,""+ku.collection())},ku.model=function(t){var e=function(t){var n=this;this.clone=function(){var t=new e(this.raw());return t.$parent=this.$parent,t},this.from=function(t){if(ku.isModel(t)){var e=t.raw();each(t.$self.computed,function(t){delete e[t]}),t=e}return each(t,function(t,e){"function"==typeof n[t]&&n[t](e)}),this.observer.notifySubscribers(this),this},this.raw=function(){var t={};return each(n.$self.properties,function(e){t[e]=n[e]()}),each(n.$self.computed,function(e){t[e]=n[e]()}),each(n.$self.relations,function(e){t[e]=n[e]().raw()}),t},this.reset=function(){return each(n.$self.properties,function(t,e){n[t](e)}),each(n.$self.relations,function(t,e){ku.isCollection(e)?n[t]().empty():n[t]().reset()}),this},this["export"]=this.raw,this["import"]=this.from,define(this),this.from(t),"function"==typeof this.init&&this.init()};return e.Collection=ku.collection(e),e.computed={},e.methods={},e.properties={},e.relations={},e.prototype.$self=e,e.extend=function(t){return t=ku.isModel(t)?t:ku.model(t),each(e.computed,function(e,n){t.computed[e]===void 0&&(t.computed[e]=n)}),each(e.methods,function(e,n){t.methods[e]===void 0&&(t.methods[e]=n)}),each(e.properties,function(e,n){t.properties[e]===void 0&&(t.properties[e]=n)}),each(e.relations,function(e,n){t.relations[e]===void 0&&(t.relations[e]=n)}),t},e.inherit=function(t){return t.extend(e)},interpretDefinition(e,t),e};var bound=[];ku.Router=function(){return this.events=new ku.Events,this.routes={},this.state=new ku.State,this.view=new ku.View,this},ku.Router.prototype={route:!1,bind:function(){return bound.push(this),"onpopstate"in window&&this.state.enabled&&(!this.state.enabled||window.location.hash)||this.dispatch(),this},unbind:function(){for(var t=0;bound.length>t;t++)this===bound[t]&&delete bound[t];return this},set:function(t,e){return"function"==typeof e&&(e={match:RegExp("^"+t+"$"),format:t,controller:e}),e.view||(e.view=t),this.routes[t]=e instanceof ku.Route?e:new ku.Route(e),this},get:function(t){if(this.has(t))return this.routes[t];throw'Route "'+t+'" does not exist.'},has:function(t){return this.routes[t]!==void 0},remove:function(t){return this.has(t)&&delete this.routes[t],this},dispatch:function(t){t===void 0&&(t=this.state.get());for(var e in this.routes){var n=this.routes[e],i=n.query(t);if("number"==typeof i.length){if(this.events.trigger("exit",[this])===!1)return this;if(this.route&&this.events.trigger("exit."+e,[this,this.route])===!1)return this;if(this.events.trigger("enter",[this])===!1)return this;if(this.events.trigger("enter."+e,[this,n])===!1)return this;var r=n.controller.apply(n.controller,i);return r&&r.constructor===Object&&(r=new(ku.model(r))),r!==!1&&this.view.render(n.view,r),this.route=n,this.state.previous=t,this}}return this.route=!1,this},go:function(t,e,n){return this.state.push(this.get(t).generate(e),n),this},generate:function(t,e){return this.get(t).generate(e)}},ku.Route=function(t){for(var e in t)this[e]=t[e];return this},ku.Route.prototype={match:/.*/,format:"",view:!1,controller:function(){},query:function(t){var e=t.match(this.match);return null===e?!1:(e.shift(),e)},generate:function(t){var e=this.format;for(var n in t)e=e.replace(RegExp("\\:"+n,"g"),t[n]);return e}};var oldState=window.location.hash,interval,isStarted=!1;ku.State=function(){return this.states={},ku.State.start(),this},ku.State.interval=500,ku.State.start=function(){if(isStarted)return ku.State;var t="onhashchange"in window&&/MSIE\s(6|7)/.test(navigator.userAgent);return"onpopstate"in window?bind("popstate"):t?(bind("hashchange"),interval=setInterval(function(){oldState!==window.location.hash&&(oldState=window.location.hash,trigger("hashchange"))},ku.State.interval)):bind("hashchange"),isStarted=!0,ku.State},ku.State.stop=function(){interval&&clearInterval(interval);var t="onpopstate"in window?"popstate":"hashchange";return window.removeEventListener?window.removeEventListener(t,dispatch):window[t]&&delete window[t],isStarted=!1,State},ku.State.prototype={previous:!1,enabled:!1,scroll:!1,get:function(){return this.enabled&&window.history.pushState?removeHostPart(window.location.href):window.location.hash.substring(1)},push:function(t,e,n){return this.enabled&&window.history.pushState?(window.history.pushState(e,n,t||"."),dispatch()):updateHash(t,this.scroll),this.states[t]=e,this},data:function(t){return t=t||this.get(),this.states[t]===void 0?null:this.states[t]}},ku.View=function(){return this.cache={},this.http=new ku.Http,this.http.prefix="views/",this.http.suffix=".html",this.http.accept="text/html",this},ku.View.prototype={http:!1,target:null,idPrefix:"ku-view-",idSuffix:"",idSeparator:"-",render:function(t,e){var n=this,i=this.idPrefix+t.replace(/\//g,this.idSeparator)+this.idSuffix;return this.cache[t]?this.renderer(this.cache[t],e):document.getElementById(i)?this.renderer(this.cache[t]=document.getElementById(i).innerHTML,e):this.http&&this.http.get(t,function(i){n.renderer(n.cache[t]=i,e)}),this},renderer:function(t,e){var n=this.target;if(!n)throw"Cannot render view because no target was specified.";"string"==typeof n?n=document.getElementById(n):"function"==typeof n&&(n=n()),n.innerHTML=t,ku.bindDescendants(n),ko.applyBindings(e,n)}};