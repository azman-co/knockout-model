!function(e){typeof require=="function"&&typeof exports=="object"&&typeof module=="object"?e(require("knockout"),module.exports||exports):typeof define=="function"&&define.amd?define(["knockout","exports"],e):e(ko,window.ku={})}(function(e,t){function r(e,t){return e?(typeof e=="object"&&e.constructor&&(e=e.constructor),typeof e=="function"&&(e=e.toString()),e===t):!1}function i(e,t){e=e||[],typeof e=="string"&&(e=[e]);if(typeof e.length=="number"){for(var n=0;n<e.length;n++)if(t(n,e[n])===!1)return}else for(var r in e)if(t(r,e[r])===!1)return}function s(){return e.computed({read:function(){return this},write:function(e){this.from(e)},owner:this})}function l(e){return e.replace(/http(s)?\:\/\/[^\/]+/,"")}function c(e){window.addEventListener?window.addEventListener(e,d,!1):window["on"+e]=d}function h(e){document.createEvent?(event=document.createEvent("HTMLEvents"),event.initEvent(e,!0,!0),window.dispatchEvent(event)):window["on"+e](document.createEventObject())}function p(e,t){if(t)return;var n=e.replace(/^#/,""),r=document.getElementById(n),i=window.pageXOffset?window.pageXOffset:document.body.scrollLeft,s=window.pageYOffset?window.pageYOffset:document.body.scrollTop,o=document.createElement("div");r&&(r.id=""),o.id=n||"_",o.style.position="absolute",o.style.width=0,o.style.height=0,o.style.left=i+"px",o.style.top=s+"px",o.style.padding=0,o.style.margin=0,document.body.appendChild(o),window.location.hash="#"+o.id,document.body.removeChild(o),r&&(r.id=n)}function d(){for(var e=0;e<o.length;e++)o[e].dispatch()}if(typeof e=="undefined")throw"KnockoutJS is required. Download at https://github.com/SteveSanderson/knockout.";t.bindings={model:function(t,n){if(this.attr(t,"view"))return;e.applyBindings(this.get(n),t)},router:function(e,n){var r=this.get(n);r||t.throwForElement(e,'Cannot bind router "'+n+'" to the main view because it does not exist.'),!r instanceof this.Router&&t.throwForElement(e,'Cannot bind router "'+n+'" to the main view because it is not an instanceof "ku.Router".'),r.view.target=e,r.bind()},view:function(e,n){var r=this.attr(e,"path"),i=this.get(this.attr(e,"model")),s;if(r)s=this.get(n);else{var o=this.attr(e,"prefix"),u=this.attr(e,"suffix");s=new t.View,o&&(s.http.prefix=o),u&&(s.http.suffix=u)}s.target=e,s.render(r,i)}},t.collection=function(e){var n=function(n){Array.prototype.push.apply(this,[]),this.observer=s.call(this),this.aggregate=function(e,t){var n=[];return t||(t=[e],e=""),this.each(function(r,s){var o=[];i(t,function(e,t){typeof s[t]=="function"&&o.push(s[t]())}),n.push(o.join(e))}),n},this.at=function(e){return typeof this[e]=="undefined"?!1:this[e]},this.first=function(){return this.at(0)},this.last=function(){return this.at(this.length-1)},this.has=function(e){return typeof this[e]!="undefined"},this.remove=function(e){return e=typeof e=="number"?e:this.index(e),this.has(e)&&(Array.prototype.splice.call(this,e,1),this.observer.notifySubscribers()),this},this.empty=function(){return Array.prototype.splice.call(this,0,this.length),this.observer.notifySubscribers(),this},this.prepend=function(e){return this.insert(0,e)},this.append=function(e){return this.insert(this.length,e)},this.insert=function(n,r){return r=t.isModel(r)?r:new e(r),r.$parent=this.$parent,Array.prototype.splice.call(this,n,0,r),this.observer.notifySubscribers(),this},this.index=function(e){var t=-1;return this.each(function(n,r){if(r===e){t=n;return}}),t},this.from=function(e){var n=this;return t.isCollection(e)&&(e=e.raw()),i(e,function(e,t){n.append(t)}),this},this.raw=function(){var e=[];return this.each(function(t,n){e.push(n.raw())}),e},this.each=function(e){for(var t=0;t<this.length;t++)e.call(this,t,this[t]);return this},this.find=function(e,n,r){var s=new this.$self.Model.Collection;return s.$parent=this.$parent,t.isModel(e)&&(e=e.raw()),typeof e=="object"&&(e=function(e){return function(){var t=this,n=!0;return i(e,function(e,r){if(typeof t[e]=="undefined"||t[e]()!==r)return n=!1,!1}),n}}(e)),this.each(function(t,i){if(n&&r){var o=n*r-n;if(o<t)return}e.call(i,t)&&s.append(i);if(n&&s.length===n)return!1}),s},this.findOne=function(e){return this.find(e,1).first()},this.from(n)};return n.Model=e,n.prototype={$self:n},n};var n={};t.set=function(e,t){return n[e]=t,this},t.get=function(e){return this.has(e)?n[e]:null},t.has=function(e){return typeof n[e]!="undefined"},t.remove=function(e){return this.has(e)&&delete n[e],this},t.reset=function(){return n={},this},t.Event=function(){return this.stack=[],this},t.Event.prototype={bind:function(e){return this.stack.push(e),this},unbind:function(e){if(e){var t=[];for(var n in this.stack)this.stack[n]!==e&&t.push(this.stack[n]);this.stack=t}else this.stack=[];return this},trigger:function(e){for(var t in this.stack)if(this.stack[t].apply(this,e)===!1)return!1}},t.Events=function(){return this.events={},this},t.Events.prototype={on:function(e,n){return typeof this.events[e]=="undefined"&&(this.events[e]=new t.Event),this.events[e].bind(n),this},off:function(e,t){return e?(typeof this.events[e]!="undefined"&&this.events[e].unbind(t),this):(this.events={},this)},trigger:function(e,t){if(typeof this.events[e]!="undefined"&&this.events[e].trigger(t)===!1)return!1}},t.Http=function(){return this.events=new t.Events,this},t.Http.prototype={prefix:"",suffix:"",headers:{},parsers:{"application/json":function(e){try{return JSON.parse(e)}catch(t){throw'Error parsing response "'+e+'" with message "'+t+'".'}}},"delete":function(e,t,n){return this.request(e,t||{},"delete",n||t)},get:function(e,t,n){return this.request(e,t||{},"get",n||t)},head:function(e,t,n){return this.request(e,t||{},"head",n||t)},options:function(e,t,n){return this.request(e,t||{},"options",n||t)},patch:function(e,t,n){return this.request(e,t,"patch",n)},post:function(e,t,n){return this.request(e,t,"post",n)},put:function(e,t,n){return this.request(e,t,"put",n)},request:function(e,n,r,i){var s=this;request=this.createRequestObject(),request.open(r.toUpperCase(),this.prefix+e+this.suffix,!0),request.setRequestHeader("Accept",this.accept);for(var o in this.headers)request.setRequestHeader(o,this.headers[o]);request.onreadystatechange=function(){if(request.readyState!==4)return;if(request.status!==200&&request.status!==304){s.events.trigger("error",[request]),s.events.trigger("stop",[request]);return}var e=request.responseText,t=request.getAllResponseHeaders();typeof t["Content-Type"]=="string"&&typeof s.parsers[t["Content-Type"]]=="function"?e=s.parsers[t["Content-Type"]](e):typeof s.headers.Accept=="string"&&typeof s.parsers[s.headers.Accept]=="function"&&(e=s.parsers[s.headers.Accept](e)),typeof i=="function"&&i(e,request),s.events.trigger("success",[e,request]),s.events.trigger("stop",[request])};if(request.readyState===4)return;return t.isModel(n)&&(n=n.raw()),typeof n=="object"&&(n=this.serialize(n)),n&&request.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),this.events.trigger("start",[request]),request.send(n),this},serialize:function(e,t){var n=[];for(var r in e){var i=t?t+"["+r+"]":r,s=e[r];n.push(typeof s=="object"?this.serialize(s,i):encodeURIComponent(i)+"="+encodeURIComponent(s))}return n.join("&")},createRequestObject:function(){var e=!1;factories=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];for(var t=0;t<factories.length;t++)try{e=factories[t]()}catch(n){continue}if(!e)throw"An XMLHttpRequest could not be generated.";return e}},t.prefix="data-ku-",t.element=document,t.run=function(e){e=e||this.element,typeof e=="function"&&(e=e()),typeof e=="string"&&(e=document.getElementById(e)),e!==document&&t.bindOne(e),t.bindDescendants(e)},t.bindOne=function(e){var t=this;i(e.attributes,function(n,r){if(r.name.indexOf(t.prefix)===0){var i=r.name.substring(t.prefix.length);typeof t.bindings[i]=="function"&&t.bindings[i].call(t,e,r.value)}})},t.bindDescendants=function(e){i(e.childNodes,function(e,n){t.run(n)})},t.attr=function(e,n,r){return n=t.prefix+n,typeof r=="undefined"?e.getAttribute?e.getAttribute(n):typeof e[n]=="undefined"?null:e[n]:r?(e.setAttribute?e.setAttribute(n,r):e[n]=r,this):(e.removeAttribute?e.removeAttribute(n):typeof e[n]!="undefined"&&delete e[n],this)},t.outerHtml=function(e){var t=document.createElement("div");return t.appendChild(e),t.innerHTML},t.throwForElement=function(e,n){throw n+"\n"+t.outerHtml(e)},t.isReader=function(e){return e.indexOf("read")===0},t.isWriter=function(e){return e.indexOf("write")===0},t.toReader=function(e){return"read"+e.substring(0,1).toUpperCase()+e.substring(1)},t.toWriter=function(e){return"write"+e.substring(0,1).toUpperCase()+e.substring(1)},t.fromReader=function(e){return e.substring(4,5).toLowerCase()+e.substring(5)},t.fromWriter=function(e){return e.substring(5,6).toLowerCase()+e.substring(6)},t.isModel=function(e){return r(e,t.model().toString())},t.isCollection=function(e){return r(e,t.collection().toString())},t.model=function(n){var r=function(o){var u={},a={},f={},l={},c=this;this.observer=s.call(this),this.from=function(e){return t.isModel(e)&&(e=e.raw()),i(e,function(e,t){typeof c[e]=="function"&&c[e](t)}),this.observer.notifySubscribers(),this},this.raw=function(){var e={};return i(a,function(t,n){e[t]=c[t]()}),i(u,function(t,n){e[t]=c[t]()}),i(f,function(t,n){e[t]=c[t]().raw()}),e},this.clone=function(){var e=new r(this.raw());return e.$parent=this.$parent,e},this.reset=function(){return i(a,function(e,t){c[e](t)}),this},i(n,function(n,r){if(t.isModel(r)||t.isCollection(r)){var i=new r;c[n]=i.observer,i.$parent=c,f[n]=r;return}if(typeof r=="function"){var s,o;t.isReader(n)?(s=t.fromReader(n),o="read"):t.isWriter(n)&&(s=t.fromWriter(n),o="write");if(o){typeof u[s]=="undefined"&&(u[s]={}),u[s][o]=r;return}c[n]=function(){return r.apply(c,arguments)},l[n]=r;return}c[n]=e.observable(r),a[n]=r}),i(u,function(t,n){n.owner=c,n.deferEvaluation=!0,c[t]=e.computed(n)}),this.from(o),typeof this.init=="function"&&this.init()};return r.Collection=t.collection(r),r.definition=n,r.prototype.$self=r,r.extend=function(e){return e=t.isModel(e)?e:t.model(e),i(n,function(t,n){typeof e.definition[t]=="undefined"&&(e.definition[t]=n)}),e},r.inherit=function(e){return e=t.isModel(e)?e:t.model(e),i(e.definition,function(e,t){n[e]=t}),r},r};var o=[];t.Router=function(){return this.events=new t.Events,this.routes={},this.state=new t.State,this.view=new t.View,this},t.Router.prototype={route:!1,bind:function(){return o.push(this),(!("onpopstate"in window)||!this.state.enabled||this.state.enabled&&!window.location.hash)&&this.dispatch(),this},unbind:function(){for(var e=0;e<o.length;e++)this===o[e]&&delete o[e];return this},set:function(e,n){return typeof n=="function"&&(n={match:new RegExp("^"+e+"$"),format:e,controller:n}),n.view||(n.view=e),this.routes[e]=n instanceof t.Route?n:new t.Route(n),this},get:function(e){if(this.has(e))return this.routes[e];throw'Route "'+e+'" does not exist.'},has:function(e){return typeof this.routes[e]!="undefined"},remove:function(e){return this.has(e)&&delete this.routes[e],this},dispatch:function(e){typeof e=="undefined"&&(e=this.state.get());for(var n in this.routes){var r=this.routes[n],i=r.query(e);if(typeof i.length!="number")continue;if(this.events.trigger("exit",[this])===!1)return this;if(this.route&&this.events.trigger("exit."+n,[this,this.route])===!1)return this;if(this.events.trigger("enter",[this])===!1)return this;if(this.events.trigger("enter."+n,[this,r])===!1)return this;var s=r.controller.apply(r.controller,i);return s&&s.constructor===Object&&(s=new(t.model(s))),s!==!1&&this.view.render(r.view,s),this.route=r,this.state.previous=e,this}return this.route=!1,this},go:function(e,t,n){return this.state.push(this.get(e).generate(t),n),this},generate:function(e,t){return this.get(e).generate(t)}},t.Route=function(e){for(var t in e)this[t]=e[t];return this},t.Route.prototype={match:/.*/,format:"",view:!1,controller:function(){},query:function(e){var t=e.match(this.match);return t===null?!1:(t.shift(),t)},generate:function(e){var t=this.format;for(var n in e)t=t.replace(new RegExp("\\:"+n,"g"),e[n]);return t}};var u=window.location.hash,a,f=!1;t.State=function(){return this.states={},t.State.start(),this},t.State.interval=500,t.State.start=function(){if(f)return t.State;var e="onhashchange"in window&&/MSIE\s(6|7)/.test(navigator.userAgent);return"onpopstate"in window?c("popstate"):e?(c("hashchange"),a=setInterval(function(){u!==window.location.hash&&(u=window.location.hash,h("hashchange"))},t.State.interval)):c("hashchange"),f=!0,t.State},t.State.stop=function(){a&&clearInterval(a);var e="onpopstate"in window?"popstate":"hashchange";return window.removeEventListener?window.removeEventListener(e,d):window[e]&&delete window[e],f=!1,State},t.State.prototype={previous:!1,enabled:!1,scroll:!1,get:function(){return this.enabled&&window.history.pushState?l(window.location.href):window.location.hash.substring(1)},push:function(e,t,n){return this.enabled&&window.history.pushState?(window.history.pushState(t,n,e||"."),d()):p(e,this.scroll),this.states[e]=t,this},data:function(e){return e=e||this.get(),typeof this.states[e]=="undefined"?null:this.states[e]}},t.View=function(){return this.cache={},this.http=new t.Http,this.http.prefix="views/",this.http.suffix=".html",this.http.accept="text/html",this},t.View.prototype={http:!1,target:null,idPrefix:"ku-view-",idSuffix:"",render:function(e,t){var n=this,r=this.idPrefix+e+this.idSuffix;return this.cache[e]?this.renderer(this.cache[e],t):document.getElementById(r)?this.renderer(this.cache[e]=document.getElementById(r).innerHTML,t):this.http&&this.http.get(e,function(r){n.renderer(n.cache[e]=r,t)}),this},renderer:function(n,r){var i=this.target;if(!i)throw"Cannot render view because no target was specified.";typeof i=="string"?i=document.getElementById(i):typeof i=="function"&&(i=i()),i.innerHTML=n,t.bindDescendants(i),e.applyBindings(r,i)}}});